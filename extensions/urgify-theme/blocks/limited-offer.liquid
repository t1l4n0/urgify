{% comment %}
  Urgify Limited Offer Block
  Displays a spectacular limited-time offer with countdown timer
{% endcomment %}

{% liquid
  # Check subscription status first
  assign subscription_active = shop.metafields.urgify.subscription_active.value | default: false
  if subscription_active != true and subscription_active != 'true'
    # No active subscription, don't render anything
    assign should_render = false
  else
    assign should_render = true
  endif
  
  # Only proceed if subscription is active
  if should_render
    assign end_ts = block.settings.end_date
    if end_ts contains ' '
      assign end_iso = end_ts | replace: ' ', 'T' | append: ':00'
    else
      assign end_iso = end_ts | append: 'T00:00:00'
    endif
    assign end_epoch = end_iso | date: '%s' | plus: 0

    assign selected_product = nil
    assign has_product = false
    assign has_product_image = false

    if block.settings.product != blank
      assign selected_product = all_products[block.settings.product]
      if selected_product
        assign has_product = true
        if selected_product.featured_image
          assign has_product_image = true
        endif
      endif
    endif

    assign extra_media_image = block.settings.extra_media_image
    assign extra_media_alt = block.settings.extra_media_alt | default: block.settings.title | default: 'Limited offer visual'
    assign extra_media_usage = block.settings.extra_media_usage | default: 'replace'
    assign extra_media_position = block.settings.extra_media_position | default: 'left'
    assign show_inline_extra = false
    assign show_side_extra = false

    if extra_media_image != blank
      if extra_media_usage == 'replace'
        assign show_inline_extra = true
      elsif extra_media_usage == 'sidecar' and has_product
        assign show_side_extra = true
      endif
    endif
  endif
%}

{% unless should_render %}
  {% comment %}No active subscription - show subscription required message{% endcomment %}
  <div style="padding: 20px; border: 2px dashed #e74c3c; border-radius: 8px; margin: 20px 0; background: #fdf2f2; text-align: center;">
    <div style="color: #e74c3c; font-weight: bold; margin-bottom: 8px;">üîí Subscription Required</div>
    <div style="color: #666; font-size: 14px; margin-bottom: 12px;">This block requires an active Urgify subscription to display.</div>
    <div style="color: #999; font-size: 12px;">Configure your settings below. The block will appear once you subscribe.</div>
  </div>
{% else %}

{{ 'urgify-limited-offer.css' | asset_url | stylesheet_tag }}

{% capture urgify_offer_block %}
<div class="urgify-limited-offer offer-style-{{ block.settings.offer_style | default: 'spectacular' }} offer-width-{{ block.settings.width | default: 'fullwidth' }} {% if block.settings.layout == 'side-by-side' %}offer-layout-side-by-side{% endif %}" 
     data-urgify="limited-offer" 
     data-block-id="{{ block.id }}"
     data-end-date="{{ end_iso }}"
     data-end-epoch="{{ end_epoch }}"
     data-layout="{{ block.settings.layout | default: 'stacked' }}"
     data-match-height="{{ block.settings.match_height_side | default: false }}"
     data-side-gap="{{ block.settings.side_gap | default: 24 }}"
     style="
       {% if block.settings.text_align != blank %}
         text-align: {{ block.settings.text_align }};
       {% endif %}
       {% if block.settings.offer_style == 'custom' %}
         --urgify-offer-bg-start: {{ block.settings.custom_background_start | default: '#0f172a' }};
         --urgify-offer-bg-end: {{ block.settings.custom_background_end | default: '#312e81' }};
         --urgify-offer-text-color: {{ block.settings.custom_text_color | default: '#f8fafc' }};
         --urgify-offer-accent-color: {{ block.settings.custom_accent_color | default: '#facc15' }};
         --urgify-offer-surface-color: {{ block.settings.custom_surface_color | default: '#1f2937' }};
         --urgify-offer-button-bg: {{ block.settings.custom_button_background | default: '#facc15' }};
         --urgify-offer-button-text: {{ block.settings.custom_button_text_color | default: '#0f172a' }};
       {% endif %}
     ">

  {% assign current_style = block.settings.offer_style | default: 'spectacular' %}

  {% if current_style == 'spectacular' or current_style == 'spectacular-blue' or current_style == 'spectacular-mint' or current_style == 'spectacular-purple' or current_style == 'spectacular-emerald' or current_style == 'spectacular-christmas' or current_style == 'custom' %}
    <!-- Background Elements -->
    <div class="offer-bg-elements">
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="sparkle"></div>
      <div class="pulse-ring"></div>
      <div class="pulse-ring"></div>
    </div>
  {% endif %}

  <!-- Main Content -->
  <div class="offer-content">
    {% if block.settings.badge_text != blank %}
      <div class="offer-badge">
        <span class="badge-icon">‚ö°</span>
        {{ block.settings.badge_text }}
      </div>
    {% endif %}

    {% if block.settings.title != blank %}
      <h2 class="offer-title">
        <span class="title-highlight">{{ block.settings.title }}</span>
        <div class="title-underline"></div>
      </h2>
    {% endif %}

    {% if block.settings.description != blank %}
      <p class="offer-description">{{ block.settings.description }}</p>
    {% endif %}

    {% if show_inline_extra %}
      {% assign extra_inline_width = 800 %}
      {% assign extra_inline_height = 450 %}
      {% if extra_media_image.aspect_ratio %}
        {% assign extra_inline_height = 800 | divided_by: extra_media_image.aspect_ratio | round %}
      {% endif %}
      <div class="offer-extra-media-inline">
        <div class="offer-extra-media-inline-inner">
          <img
            src="{{ extra_media_image | image_url: width: 800 }}"
            alt="{{ extra_media_alt | escape }}"
            loading="lazy"
            width="{{ extra_inline_width }}"
            height="{{ extra_inline_height }}"
          >
        </div>
      </div>
    {% elsif has_product %}
      <div class="offer-product">
        <a href="{{ selected_product.url }}" class="offer-product-link">
          {% if has_product_image %}
            <div class="offer-product-image">
              <img src="{{ selected_product.featured_image | image_url: width: 300 }}" 
                   alt="{{ selected_product.featured_image.alt | escape | default: selected_product.title | escape }}"
                   loading="lazy"
                   width="300"
                   height="{{ 300 | divided_by: selected_product.featured_image.aspect_ratio | round }}">
            </div>
          {% endif %}
          <div class="offer-product-info">
            <h3 class="offer-product-title">{{ selected_product.title }}</h3>
            {% assign product_variant = selected_product.selected_or_first_available_variant %}
            {% if product_variant %}
              <div class="offer-product-price">
                {% if product_variant.compare_at_price > product_variant.price %}
                  <span class="offer-product-price-compare">{{ product_variant.compare_at_price | money }}</span>
                  <span class="offer-product-price-sale">{{ product_variant.price | money }}</span>
                {% else %}
                  <span class="offer-product-price-regular">{{ product_variant.price | money }}</span>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </a>
      </div>
    {% endif %}

    {% if block.settings.show_timer %}
      <div class="offer-timer">
        <span class="timer-icon">‚è∞</span>
        <span class="timer-text">{{ block.settings.timer_text | default: 'Offer ends in:' }}</span>
        <div class="timer-countdown" id="urgify-timer-{{ block.id }}"></div>
        <div class="timer-expired-text" hidden>{{ block.settings.timer_expired_text | default: 'Offer expired' }}</div>
      </div>
    {% endif %}

    {% if block.settings.show_button and block.settings.button_text != blank %}
      <div class="offer-button-container">
        <a href="{{ block.settings.button_url | default: '#' }}" 
           class="offer-button offer-button-{{ block.settings.offer_style | default: 'spectacular' }}"
           {% if block.settings.button_target_blank %}target="_blank"{% endif %}>
          <span class="button-text">{{ block.settings.button_text }}</span>
          {% if block.settings.button_icon != blank %}
            <span class="button-icon">{{ block.settings.button_icon }}</span>
          {% endif %}
        </a>
      </div>
    {% endif %}
  </div>

  {% if current_style == 'spectacular' or current_style == 'spectacular-blue' or current_style == 'spectacular-mint' or current_style == 'spectacular-purple' or current_style == 'spectacular-emerald' or current_style == 'spectacular-christmas' or current_style == 'blackweek' or current_style == 'custom' %}
    <!-- Border Animation -->
    <div class="offer-border-animation"></div>
  {% endif %}
</div>
{% endcapture %}

{% if show_side_extra %}
  {% assign extra_side_height = 600 %}
  {% if extra_media_image.aspect_ratio %}
    {% assign extra_side_height = 600 | divided_by: extra_media_image.aspect_ratio | round %}
  {% endif %}
  <div class="urgify-limited-offer-external offer-extra-position-{{ extra_media_position }}">
    {% if extra_media_position == 'left' %}
      <div class="offer-extra-media">
        <div class="offer-extra-media-inner">
          <img
            src="{{ extra_media_image | image_url: width: 600 }}"
            alt="{{ extra_media_alt | escape }}"
            loading="lazy"
            width="600"
            height="{{ extra_side_height }}"
          >
        </div>
      </div>
    {% endif %}

    {{ urgify_offer_block | strip }}

    {% if extra_media_position == 'right' %}
      <div class="offer-extra-media">
        <div class="offer-extra-media-inner">
          <img
            src="{{ extra_media_image | image_url: width: 600 }}"
            alt="{{ extra_media_alt | escape }}"
            loading="lazy"
            width="600"
            height="{{ extra_side_height }}"
          >
        </div>
      </div>
    {% endif %}
  </div>
{% else %}
  {{ urgify_offer_block | strip }}
{% endif %}

<script>
// Globale parseIsoLocal Funktion f√ºr Limited-Offer
function parseIsoLocal(datetimeStr) {
  // akzeptiert: YYYY-MM-DD, YYYY-MM-DD HH:MM, YYYY-MM-DDTHH:MM, mit/ohne :SS
  if (!datetimeStr) return null;

  // Hat explizite TZ? -> Native Date reicht.
  if (/[+-]\d{2}:\d{2}|Z$/.test(datetimeStr)) {
    const d = new Date(datetimeStr);
    return isNaN(d) ? null : d;
  }

  // Space -> T
  const s = datetimeStr.replace(' ', 'T');

  // Mit Sekunde auff√ºllen
  const withSec = /\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(s) ? s + ':00' : s;

  // Manuell lokal parsen (sicher in allen Browsern)
  const m = withSec.match(
    /^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2})(?::(\d{2}))?)?$/
  );
  if (!m) {
    const d = new Date(withSec);
    return isNaN(d) ? null : d;
  }
  const [, Y, M, D, h = '0', mnt = '0', sec = '0'] = m;
  return new Date(
    Number(Y),
    Number(M) - 1,
    Number(D),
    Number(h),
    Number(mnt),
    Number(sec),
    0
  );
}

let urgifyLimitedOfferMatchHeightFrame = null;

function urgifyScheduleLimitedOfferMatchHeights(scope) {
  if (urgifyLimitedOfferMatchHeightFrame) {
    cancelAnimationFrame(urgifyLimitedOfferMatchHeightFrame);
  }
  urgifyLimitedOfferMatchHeightFrame = requestAnimationFrame(() => {
    urgifyLimitedOfferMatchHeightFrame = null;
    urgifyEqualizeLimitedOfferHeights(scope);
  });
}

function urgifyEqualizeLimitedOfferHeights(root) {
  const scope = root || document;
  const wrappers = Array.from(scope.querySelectorAll('.urgify-limited-offer-wrapper--side'));
  if (!wrappers.length) return;

  const rowMap = new Map();

  wrappers.forEach((wrapper) => {
    const block = wrapper.querySelector('.urgify-limited-offer');
    if (!block) return;

    const matchEnabled = block.dataset.matchHeight === 'true';
    if (!matchEnabled) {
      block.style.minHeight = '';
      wrapper.classList.remove('urgify-limited-offer-wrapper--side-match');
      return;
    }

    wrapper.classList.add('urgify-limited-offer-wrapper--side-match');
    block.style.minHeight = '';

    const parent = wrapper.parentElement;
    if (!parent) return;

    const topKey = Math.round(wrapper.getBoundingClientRect().top);
    const groupKey = `${parent.dataset.sectionId || parent.id || 'urgify'}-${topKey}`;

    if (!rowMap.has(groupKey)) {
      rowMap.set(groupKey, []);
    }
    rowMap.get(groupKey).push(block);
  });

  rowMap.forEach((blocks) => {
    if (!blocks.length) return;
    let maxHeight = 0;
    blocks.forEach((block) => {
      maxHeight = Math.max(maxHeight, block.offsetHeight);
    });
    blocks.forEach((block) => {
      block.style.minHeight = `${maxHeight}px`;
    });
  });
}

function urgifyApplyLimitedOfferLayout(root) {
  const scope = root || document;
  const existingWrappers = scope.querySelectorAll('.urgify-limited-offer-wrapper--side');
  existingWrappers.forEach((wrapper) => {
    const hasSideBySideChild = wrapper.querySelector('.urgify-limited-offer[data-layout="side-by-side"]');
    if (!hasSideBySideChild) {
      wrapper.classList.remove('urgify-limited-offer-wrapper--side');
    }
  });
  const offerBlocks = scope.querySelectorAll('.urgify-limited-offer[data-layout="side-by-side"]');
  const parentDetails = new Map();

  offerBlocks.forEach((block) => {
    const wrapper =
      block.closest('.shopify-app-block') ||
      block.closest('.shopify-block') ||
      block.parentElement;
    if (wrapper && !wrapper.classList.contains('urgify-limited-offer-wrapper--side')) {
      wrapper.classList.add('urgify-limited-offer-wrapper--side');
    }

    const parent = wrapper ? wrapper.parentElement : null;
    if (parent) {
      const details = parentDetails.get(parent) || { count: 0, gaps: [] };
      details.count += 1;
      const blockGap = Number(block.dataset.sideGap || 24);
      if (!isNaN(blockGap)) {
        details.gaps.push(blockGap);
      }
      parentDetails.set(parent, details);
    }
  });

  const containerScope =
    scope === document
      ? document
      : scope.closest('.shopify-section') || scope;
  const existingContainers = containerScope.querySelectorAll('.urgify-limited-offer-side-container');
  existingContainers.forEach((container) => {
    const wrapperCount = container.querySelectorAll('.urgify-limited-offer-wrapper--side').length;
    if (wrapperCount < 2) {
      container.classList.remove('urgify-limited-offer-side-container');
      container.style.removeProperty('--urgify-side-gap');
    }
  });

  parentDetails.forEach((details, parent) => {
    if (details.count > 1) {
      const gapValue =
        details.gaps.length > 0
          ? Math.max(...details.gaps)
          : 24;
      parent.classList.add('urgify-limited-offer-side-container');
      parent.style.setProperty('--urgify-side-gap', `${gapValue}px`);
    } else {
      parent.classList.remove('urgify-limited-offer-side-container');
      parent.style.removeProperty('--urgify-side-gap');
    }
  });

  urgifyScheduleLimitedOfferMatchHeights(scope);
}

document.addEventListener('DOMContentLoaded', function() {
  urgifyApplyLimitedOfferLayout(document);
  urgifyScheduleLimitedOfferMatchHeights(document);
  const offerBlocks = document.querySelectorAll('[data-urgify="limited-offer"]');
  
  offerBlocks.forEach(block => {
    const blockId = block.dataset.blockId;
    const timerElement = block.querySelector('.timer-countdown');
    const endDateString = block.dataset.endDate;
    
    if (timerElement && endDateString) {
      const timerWrapper = block.querySelector('.offer-timer');
      const timerIcon = timerWrapper ? timerWrapper.querySelector('.timer-icon') : null;
      const timerLabel = timerWrapper ? timerWrapper.querySelector('.timer-text') : null;
      const expiredTextElement = timerWrapper ? timerWrapper.querySelector('.timer-expired-text') : null;
      // Parse the end date - handle different formats
      let endDate;
      
      // 1) Epoch (vom Liquid sicher geliefert) bevorzugen
      const endEpoch = Number(block.dataset.endEpoch || 0);
      if (endEpoch > 0) {
        endDate = endEpoch * 1000;
      } else {
        // 2) Fallback auf robustes Parsing
        endDate = (function(){
          const d = parseIsoLocal(endDateString);
          return d ? d.getTime() : NaN;
        })();
      }
      
      // Check if date is valid
      if (isNaN(endDate)) {
        timerElement.innerHTML = 'Invalid Date';
        return;
      }
      
      let timerIntervalId;

      function showActiveTimerParts(isActive) {
        const displayValue = isActive ? '' : 'none';
        if (timerIcon) {
          timerIcon.style.display = displayValue;
        }
        if (timerLabel) {
          timerLabel.style.display = displayValue;
        }
        if (timerElement) {
          timerElement.style.display = displayValue;
        }
        if (expiredTextElement) {
          expiredTextElement.hidden = isActive;
          expiredTextElement.style.display = isActive ? 'none' : '';
        }
      }

      function updateTimer() {
        const now = new Date().getTime();
        const timeLeft = endDate - now;
        
        if (timeLeft > 0) {
          showActiveTimerParts(true);
          const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
          const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
          const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
          
          timerElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        } else {
          showActiveTimerParts(false);
          if (!expiredTextElement) {
            timerElement.innerHTML = 'Offer Expired';
          }
          if (timerIntervalId) {
            clearInterval(timerIntervalId);
          }
        }
      }
      
      updateTimer();
      timerIntervalId = setInterval(updateTimer, 1000);
    }
  });
});

document.addEventListener('shopify:section:load', function(event) {
  urgifyApplyLimitedOfferLayout(event.target);
  urgifyScheduleLimitedOfferMatchHeights(event.target);
});

document.addEventListener('shopify:block:select', function(event) {
  if (event.target) {
    urgifyApplyLimitedOfferLayout(event.target);
    urgifyScheduleLimitedOfferMatchHeights(event.target);
  }
});

window.addEventListener('resize', function() {
  urgifyScheduleLimitedOfferMatchHeights(document);
});
</script>

{% endunless %}

{% schema %}
{
  "name": "Limited Offer",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Select a product to display in the offer"
    },
    {
      "type": "image_picker",
      "id": "extra_media_image",
      "label": "Additional marketing image",
      "info": "Displays a custom banner either instead of the product area or next to it."
    },
    {
      "type": "text",
      "id": "extra_media_alt",
      "label": "Additional image alt text",
      "default": "Limited offer visual"
    },
    {
      "type": "select",
      "id": "extra_media_usage",
      "label": "Additional image usage",
      "options": [
        { "value": "replace", "label": "Replace the product area inside the offer" },
        { "value": "sidecar", "label": "Show next to the offer when a product is selected" }
      ],
      "default": "replace",
      "info": "Choose whether the additional image replaces the product or appears beside it."
    },
    {
      "type": "select",
      "id": "extra_media_position",
      "label": "Side image position",
      "options": [
        { "value": "left", "label": "Left of the offer content" },
        { "value": "right", "label": "Right of the offer content" }
      ],
      "default": "left",
      "info": "Applies when the additional image is shown next to the offer."
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge Text",
      "default": "LIMITED TIME OFFER"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Special Discount"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Don't miss out on this amazing deal! Limited time only."
    },
    {
      "type": "checkbox",
      "id": "show_timer",
      "label": "Show Countdown Timer",
      "default": true
    },
    {
      "type": "text",
      "id": "timer_text",
      "label": "Timer Text",
      "default": "Offer ends in:"
    },
    {
      "type": "text",
      "id": "timer_expired_text",
      "label": "Text after countdown ends",
      "default": "Offer expired",
      "info": "Shown once the countdown reached zero."
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "End Date & Time",
      "info": "When the offer expires (YYYY-MM-DD HH:MM format, e.g. 2025-12-31 23:59)",
      "placeholder": "2025-12-31 23:59",
      "default": "2025-12-31 23:59"
    },
    {
      "type": "header",
      "content": "Call-to-Action Button"
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show Button",
      "default": true,
      "info": "Enable or disable the call-to-action button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button Link",
      "info": "Where the button should link to"
    },
    {
      "type": "select",
      "id": "button_icon",
      "label": "Button Icon",
      "options": [
        {"value": "", "label": "No Icon"},
        {"value": "‚Üí", "label": "Arrow Right (‚Üí)"},
        {"value": "üõí", "label": "Shopping Cart (üõí)"},
        {"value": "üíé", "label": "Diamond (üíé)"},
        {"value": "‚ö°", "label": "Lightning (‚ö°)"},
        {"value": "üî•", "label": "Fire (üî•)"},
        {"value": "‚≠ê", "label": "Star (‚≠ê)"},
        {"value": "üéØ", "label": "Target (üéØ)"},
        {"value": "üí´", "label": "Dizzy Star (üí´)"},
        {"value": "üöÄ", "label": "Rocket (üöÄ)"},
        {"value": "‚ú®", "label": "Sparkles (‚ú®)"},
        {"value": "üíù", "label": "Gift (üíù)"},
        {"value": "üèÜ", "label": "Trophy (üèÜ)"},
        {"value": "üí∞", "label": "Money Bag (üí∞)"},
        {"value": "üéâ", "label": "Party (üéâ)"},
        {"value": "‚ù§Ô∏è", "label": "Heart (‚ù§Ô∏è)"},
        {"value": "üëë", "label": "Crown (üëë)"},
        {"value": "üéÅ", "label": "Present (üéÅ)"},
        {"value": "üíØ", "label": "Hundred (üíØ)"},
        {"value": "üîî", "label": "Bell (üîî)"}
      ],
      "default": "‚Üí",
      "info": "Choose an icon for the button"
    },
    {
      "type": "checkbox",
      "id": "button_target_blank",
      "label": "Open in New Tab",
      "default": false
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "select",
      "id": "offer_style",
      "label": "Offer Style",
      "options": [
        {"value": "spectacular", "label": "Spectacular Red"},
        {"value": "spectacular-blue", "label": "Spectacular Blue"},
        {"value": "spectacular-mint", "label": "Spectacular Mint"},
        {"value": "spectacular-purple", "label": "Spectacular Purple"},
        {"value": "spectacular-emerald", "label": "Spectacular Emerald"},
        {"value": "spectacular-christmas", "label": "Spectacular Christmas"},
        {"value": "blackweek", "label": "Blackweek"},
        {"value": "brutalist", "label": "Brutalist Bold"},
        {"value": "glassmorphism", "label": "Glassmorphism"},
        {"value": "neumorphism", "label": "Neumorphism"},
        {"value": "custom", "label": "Custom Colors"}
      ],
      "default": "spectacular",
      "info": "Choose the visual style for your offer block"
    },
    {
      "type": "paragraph",
      "content": "Enable \"Custom Colors\" above to unlock the color controls below."
    },
    {
      "type": "color",
      "id": "custom_background_start",
      "label": "Custom background (start)",
      "default": "#0f172a"
    },
    {
      "type": "color",
      "id": "custom_background_end",
      "label": "Custom background (end)",
      "default": "#312e81"
    },
    {
      "type": "color",
      "id": "custom_text_color",
      "label": "Text color",
      "default": "#f8fafc"
    },
    {
      "type": "color",
      "id": "custom_accent_color",
      "label": "Accent color",
      "default": "#facc15"
    },
    {
      "type": "color",
      "id": "custom_surface_color",
      "label": "Badge & timer background",
      "default": "#1f2937"
    },
    {
      "type": "color",
      "id": "custom_button_background",
      "label": "Button background",
      "default": "#facc15"
    },
    {
      "type": "color",
      "id": "custom_button_text_color",
      "label": "Button text color",
      "default": "#0f172a"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout Mode",
      "options": [
        {"value": "stacked", "label": "Stacked (Standard)"},
        {"value": "side-by-side", "label": "Side by Side"}
      ],
      "default": "stacked",
      "info": "Choose 'Side by Side' to display multiple blocks next to each other. On mobile devices, blocks will automatically stack vertically."
    },
    {
      "type": "checkbox",
      "id": "match_height_side",
      "label": "Enable equal height in side-by-side rows",
      "default": false,
      "info": "When enabled, blocks in the same side-by-side row stretch to the same height. Useful if one block has a timer or more text."
    },
    {
      "type": "select",
      "id": "width",
      "label": "Width",
      "options": [
        {"value": "fullwidth", "label": "Full Width"},
        {"value": "container", "label": "Container"},
        {"value": "narrow", "label": "Narrow"},
        {"value": "super-narrow", "label": "Super Narrow"},
        {"value": "ultra-narrow", "label": "Ultra Narrow"}
      ],
      "default": "fullwidth",
      "info": "Control the width of the offer block"
    },
    {
      "type": "range",
      "id": "side_gap",
      "label": "Side-by-side spacing",
      "min": 0,
      "max": 80,
      "step": 2,
      "default": 24,
      "unit": "px",
      "info": "Distance between two offers when they are shown next to each other."
    },
    {
      "type": "header",
      "content": "Alignment"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "Text Alignment",
      "options": [
        {"value": "left", "label": "Left"},
        {"value": "center", "label": "Center"},
        {"value": "right", "label": "Right"}
      ],
      "default": "center"
    }
  ]
}
{% endschema %}