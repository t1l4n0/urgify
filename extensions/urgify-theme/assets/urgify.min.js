!function(){"use strict";if(window.Urgify)console.log("Urgify already defined, skipping redefinition.");else{class t{constructor(t,e){t&&t.nodeType===Node.ELEMENT_NODE&&(this.block=t,this.settings=this.parseSettings(),this.countdownInterval=null,this.isExpired=!1,this.init())}parseSettings(){try{const t=this.block.getAttribute("data-settings");return t?JSON.parse(t):{}}catch(t){return console.error("Error parsing countdown settings:",t),{}}}init(){this.settings.target_datetime?(this.setupCountdown(),this.updateCountdown()):console.warn("No target datetime set for countdown")}setupCountdown(){const t=this.block.querySelector(".countdown-container");t?(t.style.display="flex",this.block.style.display="block",this.countdownInterval=setInterval(()=>{this.updateCountdown()},1e3)):console.warn("Countdown container not found")}updateCountdown(){const t=new Date,e=this.settings.target_datetime?new Date(this.settings.target_datetime):null;if(!e||isNaN(e.getTime()))return void this.stopCountdown();const s=e-t;s<=0?this.handleExpired():(this.isExpired=!1,this.calculateAndDisplayTime(s))}calculateAndDisplayTime(t){const e=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),o=Math.floor(t%6e4/1e3);this.updateDisplay(e,s,i,o)}updateDisplay(t,e,s,i){switch(this.settings.countdown_style||"digital"){case"digital":default:this.updateDigitalDisplay(t,e,s,i);break;case"flip":this.updateFlipDisplay(t,e,s,i);break;case"circular":this.updateCircularDisplay(t,e,s,i);break;case"minimal":this.updateMinimalDisplay(t,e,s,i)}}updateDigitalDisplay(t,e,s,i){const o=this.block.id.replace("urgify-countdown-",""),n=this.block.querySelector("#days-"+o),r=this.block.querySelector("#hours-"+o),a=this.block.querySelector("#minutes-"+o),c=this.block.querySelector("#seconds-"+o);n&&this.settings.show_days&&(n.textContent=this.padZero(t)),r&&this.settings.show_hours&&(r.textContent=this.padZero(e)),a&&this.settings.show_minutes&&(a.textContent=this.padZero(s)),c&&this.settings.show_seconds&&(c.textContent=this.padZero(i))}updateFlipDisplay(t,e,s,i){const o=this.block.id.replace("urgify-countdown-","");this.updateFlipCard("days",t,o),this.updateFlipCard("hours",e,o),this.updateFlipCard("minutes",s,o),this.updateFlipCard("seconds",i,o)}updateFlipCard(t,e,s){const i=this.block.querySelector(`[data-${t}="${s}"]`)?.closest(".flip-card");if(!i)return;const o=i.querySelector(`#${t}-${s}`),n=i.querySelector(`#${t}-${s}-back`);if(!o||!n)return;const r=o.textContent,a=this.padZero(e);if(r!==a){i.classList.contains("flipped")?(o.textContent=a,i.classList.remove("flipped")):(n.textContent=a,i.classList.add("flipped"))}}updateCircularDisplay(t,e,s,i){const o=this.block.id.replace("urgify-countdown-",""),n=this.block.querySelector("#days-"+o),r=this.block.querySelector("#hours-"+o),a=this.block.querySelector("#minutes-"+o),c=this.block.querySelector("#seconds-"+o);n&&this.settings.show_days&&(n.textContent=this.padZero(t)),r&&this.settings.show_hours&&(r.textContent=this.padZero(e)),a&&this.settings.show_minutes&&(a.textContent=this.padZero(s)),c&&this.settings.show_seconds&&(c.textContent=this.padZero(i)),this.updateCircularProgress("days",t,365,o),this.updateCircularProgress("hours",e,24,o),this.updateCircularProgress("minutes",s,60,o),this.updateCircularProgress("seconds",i,60,o)}updateCircularProgress(t,e,s,i){const o=this.block.querySelector(`[data-${t}="${i}"]`);if(!o)return;const n=2*Math.PI*52,r=n-e/s*n;o.style.strokeDasharray=n,o.style.strokeDashoffset=r}updateMinimalDisplay(t,e,s,i){const o=this.block.id.replace("urgify-countdown-",""),n=this.block.querySelector("#days-"+o),r=this.block.querySelector("#hours-"+o),a=this.block.querySelector("#minutes-"+o),c=this.block.querySelector("#seconds-"+o);n&&this.settings.show_days&&(n.textContent=this.padZero(t)),r&&this.settings.show_hours&&(r.textContent=this.padZero(e)),a&&this.settings.show_minutes&&(a.textContent=this.padZero(s)),c&&this.settings.show_seconds&&(c.textContent=this.padZero(i))}padZero(t){return t.toString().padStart(2,"0")}handleExpired(){if(this.isExpired)return;this.isExpired=!0,this.stopCountdown();const t=this.block.querySelector(".countdown-container");t&&(t.innerHTML=this.settings.expired_message||"Time's up!",t.classList.add("expired"));const e=new CustomEvent("urgify:countdown:expired",{detail:{block:this.block,settings:this.settings}});document.dispatchEvent(e)}stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}destroy(){this.stopCountdown()}}class e{constructor(t,e){this.block=t,this.options=e}init(){this.updateStockDisplay(),document.addEventListener("change",t=>{"id"===t.target.name&&t.target.closest('form[action*="/cart/add"]')&&this.updateStockDisplay()})}updateStockDisplay(){const{threshold:t,criticalThreshold:e}=this.options;let s=this.getStockLevel();null!==s?this.displayStockAlert(s,t,e):this.showServerSideAlert()}getStockLevel(){if(window.ShopifyAnalytics?.meta?.product){const t=window.ShopifyAnalytics.meta.product;return t.variants?.[0]?.inventory_quantity||null}const t=document.querySelector('form[action*="/cart/add"]');if(t){const e=t.querySelector('select[name="id"]');if(e){const t=e.options[e.selectedIndex],s=t?.dataset?.inventoryQuantity;if(s)return parseInt(s)}}return null}displayStockAlert(t,e,s){const i=this.block.querySelector(".low-stock"),o=this.block.querySelector(".critical-stock"),n=this.block.querySelector(".stock-level");if(i&&(i.style.display="none"),o&&(o.style.display="none"),t>0&&t<=s?o&&(this.updateAlertMessage(o,t,"critical"),o.style.display="block"):t>0&&t<=e&&i&&(this.updateAlertMessage(i,t,"low"),i.style.display="block"),n){const e=n.querySelector(".stock-level-count");e&&(e.textContent=t)}}updateAlertMessage(t,e,s){const i=t.querySelector(".stock-alert-message");if(i){const t=("critical"===s?this.block.dataset.criticalMessage:this.block.dataset.alertMessage).replace("{{count}}",e);i.textContent=t}}showServerSideAlert(){const t=this.block.querySelector(".low-stock"),e=this.block.querySelector(".critical-stock");e&&"none"!==e.style.display?console.log("Showing server-side critical stock alert"):t&&"none"!==t.style.display&&console.log("Showing server-side low stock alert")}}class s{constructor(t){this.block=t}init(){}}class i{constructor(t){this.block=t}init(){console.log("Scarcity Banner block initialized")}}class o{constructor(t){this.block=t}init(){try{this.block.style.display="block";const t=this.block.getAttribute("data-auto-close-delay"),e=t?parseInt(t,10):0;!isNaN(e)&&e>0&&setTimeout(()=>{this.block.style.display="none"},1e3*e);const s=this.block.querySelector(".notification-close");s&&s.addEventListener("click",()=>{this.block.style.display="none"}),this.block.setAttribute("role","status"),this.block.setAttribute("aria-live","polite")}catch(t){console.error("UrgifyUrgencyNotification init error:",t)}}}window.Urgify=new class{constructor(){this.blocks=new Map,this.config=window.UrgifyCore?.config||{},this.initialized=!1}init(){if(this.initialized)return;document.querySelectorAll("[data-urgify]").forEach(t=>this.initBlock(t)),this.observeChanges(),this.initialized=!0}initBlock(t){const e=t.dataset.urgify,s=t.dataset.blockId||t.id;if(e&&s){if(!this.blocks.has(s))try{switch(e){case"countdown":this.initCountdown(t);break;case"stock-alert":this.initStockAlert(t);break;case"limited-offer":this.initLimitedOffer(t);break;case"scarcity-banner":this.initScarcityBanner(t);break;case"urgency-notification":this.initUrgencyNotification(t);break;default:console.warn(`Unknown block type: ${e}`)}this.blocks.set(s,{type:e,element:t})}catch(t){console.error(`Error initializing ${e} block:`,t)}}else console.warn("Block missing required data attributes:",t)}initCountdown(e){new t(e)}initStockAlert(t){const s=t.dataset.productId,i=t.dataset.variantId,o=parseInt(t.dataset.threshold)||10,n=parseInt(t.dataset.criticalThreshold)||5;new e(t,{productId:s,variantId:i,threshold:o,criticalThreshold:n}).init()}initLimitedOffer(t){new s(t).init()}initScarcityBanner(t){new i(t).init()}initUrgencyNotification(t){new o(t).init()}observeChanges(){if("undefined"!=typeof MutationObserver){new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){t.dataset&&t.dataset.urgify&&this.initBlock(t);const e=t.querySelectorAll&&t.querySelectorAll("[data-urgify]");e&&e.forEach(t=>this.initBlock(t))}})})}).observe(document.body,{childList:!0,subtree:!0})}}getBlock(t){return this.blocks.get(t)}destroyBlock(t){this.blocks.get(t)&&(this.blocks.delete(t),console.log(`Destroyed block: ${t}`))}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.Urgify.init()}):window.Urgify.init(),document.addEventListener("shopify:section:load",e=>{e.target.querySelectorAll('[data-urgify="countdown"]').forEach(e=>{new t(e)})})}}();