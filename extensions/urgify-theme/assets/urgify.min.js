(()=>{if(window.Urgify&&"function"==typeof window.Urgify.init){try{window.Urgify.init(),console.log("Urgify re-initialized.")}catch(t){console.error("Urgify re-init error:",t)}return}class e{constructor(t,e){t&&t.nodeType===Node.ELEMENT_NODE&&(this.block=t,this.settings=this.parseSettings(),this.countdownInterval=null,this.isExpired=!1,this.init())}parseSettings(){try{var t=this.block.getAttribute("data-settings");return t?JSON.parse(t):{}}catch(t){return console.error("Error parsing countdown settings:",t),{}}}init(){this.settings.target_datetime?(this.setupCountdown(),this.updateCountdown()):console.warn("No target datetime set for countdown")}setupCountdown(){var t=this.block.querySelector(".countdown-container");t?(t.style.display="flex",t.classList.add("is-ready"),this.block.style.display="block",this.countdownInterval=setInterval(()=>{this.updateCountdown()},1e3)):console.warn("Countdown container not found")}parseIsoLocal(t){var e,i,s,o,r,a;return t?/[+-]\d{2}:\d{2}|Z$/.test(t)?(e=new Date(t),isNaN(e)?null:e):(e=t.replace(" ","T"),(e=(t=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(e)?e+":00":e).match(/^(\d{4})-(\d{2})-(\d{2})(?:T(\d{2}):(\d{2})(?::(\d{2}))?)?$/))?([,e,i,s,o="0",r="0",a="0"]=e,new Date(Number(e),Number(i)-1,Number(s),Number(o),Number(r),Number(a),0)):(e=new Date(t),isNaN(e)?null:e)):null}updateCountdown(){var t=new Date;let e=null;"number"==typeof this.settings.target_epoch&&0<this.settings.target_epoch?e=new Date(1e3*this.settings.target_epoch):this.settings.target_datetime&&(e=this.parseIsoLocal(this.settings.target_datetime)),!e||isNaN(e.getTime())?(console.error("Invalid target datetime:",this.settings.target_datetime,this.settings),this.stopCountdown()):(t=e-t)<=0?this.handleExpired():(this.isExpired=!1,this.calculateAndDisplayTime(t))}calculateAndDisplayTime(t){var e=Math.floor(t/864e5),i=Math.floor(t%864e5/36e5),s=Math.floor(t%36e5/6e4),t=Math.floor(t%6e4/1e3);this.updateDisplay(e,i,s,t)}updateDisplay(t,e,i,s){switch(this.settings.countdown_style||"digital"){case"digital":this.updateDigitalDisplay(t,e,i,s);break;case"flip":this.updateFlipDisplay(t,e,i,s);break;case"circular":this.updateCircularDisplay(t,e,i,s);break;case"minimal":this.updateMinimalDisplay(t,e,i,s);break;default:this.updateDigitalDisplay(t,e,i,s)}}updateDigitalDisplay(t,e,i,s){var o=this.block.id.replace("urgify-countdown-",""),r=this.block.querySelector("#days-"+o),a=this.block.querySelector("#hours-"+o),n=this.block.querySelector("#minutes-"+o),o=this.block.querySelector("#seconds-"+o);r&&this.settings.show_days&&(r.textContent=this.padZero(t)),a&&this.settings.show_hours&&(a.textContent=this.padZero(e)),n&&this.settings.show_minutes&&(n.textContent=this.padZero(i)),o&&this.settings.show_seconds&&(o.textContent=this.padZero(s))}updateFlipDisplay(t,e,i,s){var o=this.block.id.replace("urgify-countdown-","");this.updateFlipCard("days",t,o),this.updateFlipCard("hours",e,o),this.updateFlipCard("minutes",i,o),this.updateFlipCard("seconds",s,o)}updateFlipCard(t,e,i){var s,o=this.block.querySelector(`.flip-card[data-${t}="${i}"]`);o&&(s=o.querySelector(`#${t}-`+i),t=o.querySelector(`#${t}-${i}-back`),s)&&t&&s.textContent!==(i=this.padZero(e))&&(o.classList.contains("flipped")?(s.textContent=i,o.classList.remove("flipped")):(t.textContent=i,o.classList.add("flipped")))}updateCircularDisplay(t,e,i,s){var o=this.block.id.replace("urgify-countdown-",""),r=this.block.querySelector("#days-"+o),a=this.block.querySelector("#hours-"+o),n=this.block.querySelector("#minutes-"+o),l=this.block.querySelector("#seconds-"+o);r&&this.settings.show_days&&(r.textContent=this.padZero(t)),a&&this.settings.show_hours&&(a.textContent=this.padZero(e)),n&&this.settings.show_minutes&&(n.textContent=this.padZero(i)),l&&this.settings.show_seconds&&(l.textContent=this.padZero(s)),this.updateCircularProgress("days",t,365,o),this.updateCircularProgress("hours",e,24,o),this.updateCircularProgress("minutes",i,60,o),this.updateCircularProgress("seconds",s,60,o)}updateCircularProgress(t,e,i,s){t=this.block.querySelector(`.circular-progress-bar[data-${t}="${s}"]`);t&&(e=(s=2*Math.PI*52)-e/i*s,t.style.strokeDasharray=s,t.style.strokeDashoffset=e)}updateMinimalDisplay(t,e,i,s){var o=this.block.id.replace("urgify-countdown-",""),r=this.block.querySelector("#days-"+o),a=this.block.querySelector("#hours-"+o),n=this.block.querySelector("#minutes-"+o),o=this.block.querySelector("#seconds-"+o);r&&this.settings.show_days&&(r.textContent=this.padZero(t)),a&&this.settings.show_hours&&(a.textContent=this.padZero(e)),n&&this.settings.show_minutes&&(n.textContent=this.padZero(i)),o&&this.settings.show_seconds&&(o.textContent=this.padZero(s))}padZero(t){return t.toString().padStart(2,"0")}handleExpired(){var t;this.isExpired||(this.isExpired=!0,this.stopCountdown(),(t=this.block.querySelector(".countdown-container"))&&(t.innerHTML=this.settings.expired_message||"Time's up!",t.classList.add("expired")),t=new CustomEvent("urgify:countdown:expired",{detail:{block:this.block,settings:this.settings}}),document.dispatchEvent(t))}stopCountdown(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}destroy(){this.stopCountdown()}}class r{constructor(t,e){this.block=t,this.options=e}init(){this.updateStockDisplay(),document.addEventListener("change",t=>{"id"===t.target.name&&t.target.closest('form[action*="/cart/add"]')&&this.updateStockDisplay()})}updateStockDisplay(){var{threshold:t,criticalThreshold:e}=this.options,i=this.getStockLevel();null===i?this.showServerSideAlert():this.displayStockAlert(i,t,e)}getStockLevel(){if(window.ShopifyAnalytics?.meta?.product)return window.ShopifyAnalytics.meta.product.variants?.[0]?.inventory_quantity||null;var t=document.querySelector('form[action*="/cart/add"]');if(t){t=t.querySelector('select[name="id"]');if(t){t=t.options[t.selectedIndex]?.dataset?.inventoryQuantity;if(t)return parseInt(t)}}return null}displayStockAlert(t,e,i){var s=this.block.querySelector(".low-stock"),o=this.block.querySelector(".critical-stock"),r=this.block.querySelector(".stock-level");s&&(s.style.display="none"),o&&(o.style.display="none"),0<t&&t<=i?o&&(this.updateAlertMessage(o,t,"critical"),o.style.display="block"):0<t&&t<=e&&s&&(this.updateAlertMessage(s,t,"low"),s.style.display="block"),r&&(i=r.querySelector(".stock-level-count"))&&(i.textContent=t)}updateAlertMessage(t,e,i){t=t.querySelector(".stock-alert-message");t&&(i=("critical"===i?this.block.dataset.criticalMessage:this.block.dataset.alertMessage).replace("{{count}}",e),t.textContent=i)}showServerSideAlert(){var t=this.block.querySelector(".low-stock"),e=this.block.querySelector(".critical-stock");e&&"none"!==e.style.display?console.log("Showing server-side critical stock alert"):t&&"none"!==t.style.display&&console.log("Showing server-side low stock alert")}}class i{constructor(t){this.block=t}init(){}}class s{constructor(t){this.block=t}init(){console.log("Scarcity Banner block initialized")}}class o{constructor(t){this.block=t}init(){try{this.block.style.display="block";var t=this.block.getAttribute("data-auto-close-delay"),e=t?parseInt(t,10):0,i=(!isNaN(e)&&0<e&&setTimeout(()=>{this.block.style.display="none"},1e3*e),this.block.querySelector(".notification-close"));i&&i.addEventListener("click",()=>{this.block.style.display="none"}),this.block.setAttribute("role","status"),this.block.setAttribute("aria-live","polite")}catch(t){console.error("UrgifyUrgencyNotification init error:",t)}}}window.Urgify=new class{constructor(){this.blocks=new Map,this.config=window.UrgifyCore?.config||{},this.initialized=!1}init(){this.initialized||(document.querySelectorAll("[data-urgify]").forEach(t=>this.initBlock(t)),this.observeChanges(),this.initialized=!0)}initBlock(t){var e=t.dataset.urgify,i=t.dataset.blockId||t.id;if(e&&i){if(!this.blocks.has(i))try{switch(e){case"countdown":this.initCountdown(t);break;case"stock-alert":this.initStockAlert(t);break;case"limited-offer":this.initLimitedOffer(t);break;case"scarcity-banner":this.initScarcityBanner(t);break;case"urgency-notification":this.initUrgencyNotification(t);break;default:console.warn("Unknown block type: "+e)}this.blocks.set(i,{type:e,element:t})}catch(t){console.error(`Error initializing ${e} block:`,t)}}else console.warn("Block missing required data attributes:",t)}initCountdown(t){new e(t)}initStockAlert(t){var e=t.dataset.productId,i=t.dataset.variantId,s=parseInt(t.dataset.threshold)||10,o=parseInt(t.dataset.criticalThreshold)||5;new r(t,{productId:e,variantId:i,threshold:s,criticalThreshold:o}).init()}initLimitedOffer(t){new i(t).init()}initScarcityBanner(t){new s(t).init()}initUrgencyNotification(t){new o(t).init()}observeChanges(){"undefined"!=typeof MutationObserver&&new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{t.nodeType===Node.ELEMENT_NODE&&(t.dataset&&t.dataset.urgify&&this.initBlock(t),t=t.querySelectorAll&&t.querySelectorAll("[data-urgify]"))&&t.forEach(t=>this.initBlock(t))})})}).observe(document.body,{childList:!0,subtree:!0})}getBlock(t){return this.blocks.get(t)}destroyBlock(t){this.blocks.get(t)&&(this.blocks.delete(t),console.log("Destroyed block: "+t))}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.Urgify.init()}):window.Urgify.init(),document.addEventListener("shopify:section:load",t=>{t.target.querySelectorAll('[data-urgify="countdown"]').forEach(t=>{new e(t)})})})();