{% comment %}
  Global app embed: injects stock alert automatically on product pages
  when enabled via Urgify settings. No manual block placement required.
{% endcomment %}
{% liquid
  # Check subscription status first
  assign subscription_active = shop.metafields.urgify.subscription_active.value | default: false
  if subscription_active != true and subscription_active != 'true'
    # No active subscription, don't load anything
    assign should_load = false
  else
    assign should_load = true
  endif
  
  if should_load
    # Configuration loaded in individual snippets as needed
  endif
%}

{% unless should_load %}
  {%- comment -%} Subscription inactive â†’ render nothing on storefront {%- endcomment -%}
{% else %}
{{ 'urgify.min.css' | asset_url | stylesheet_tag }}
{{ 'urgify-stock-alert.css' | asset_url | stylesheet_tag }}
{% assign stock_alert_config = shop.metafields.urgify.stock_alert_config.value | default: '{}' %}
{% assign stock_alert_variant_cache = shop.metafields.urgify.stock_alert_variant_cache.value | default: '{}' %}
<script>
  window.__urgifyConfig = Object.assign(
    {},
    window.__urgifyConfig || {},
    {{ stock_alert_config }}
  );
  window.__urgifyConfig.low_stock_cache = {{ stock_alert_variant_cache }};
</script>
<script src="{{ 'urgify.js' | asset_url }}" defer></script>
<script src="{{ 'urgify-stock-alert.js' | asset_url }}" defer></script>
{% render 'urgify-stock-alert-auto' %}
{% render 'urgify-popup-auto' %}
{% endunless %}

{% comment %}Cart Upsell loads independently of subscription{% endcomment %}
{% comment %}
  Cart Upsell is controlled by the shop metafield (urgify.cart_upsell_config).
  It loads independently of subscription status.
{% endcomment %}
{% render 'urgify-slide-cart-upsell-auto' %}


